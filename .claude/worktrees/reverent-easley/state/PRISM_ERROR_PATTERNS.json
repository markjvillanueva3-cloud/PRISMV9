{
  "version": "1.0",
  "description": "PRISM Error Patterns - Learned patterns for error prevention",
  "updated": "2026-02-02T00:30:00Z",
  "categories": {
    "tool_errors": "Errors from tool calls (Desktop Commander, MCP, etc.)",
    "validation_errors": "Quality and safety validation failures",
    "python_errors": "Python exceptions and runtime errors",
    "cnc_errors": "CNC machine and controller errors",
    "data_errors": "Data integrity and format errors",
    "session_errors": "Session and context management errors"
  },
  "patterns": [
    {
      "id": "PAT-TOOL-001",
      "category": "tool_errors",
      "name": "File Not Found",
      "trigger": "FileNotFoundError|No such file|File not found|ENOENT",
      "severity": "MEDIUM",
      "prevention": "Verify file exists with Desktop Commander:get_file_info before reading",
      "fix": "Check path spelling, verify working directory, use absolute paths",
      "confidence": 0.9
    },
    {
      "id": "PAT-TOOL-002",
      "category": "tool_errors",
      "name": "Permission Denied",
      "trigger": "PermissionError|Permission denied|Access denied|EACCES",
      "severity": "HIGH",
      "prevention": "Check file permissions before operations, avoid system directories",
      "fix": "Use elevated permissions or choose different location",
      "confidence": 0.85
    },
    {
      "id": "PAT-TOOL-003",
      "category": "tool_errors",
      "name": "Encoding Error",
      "trigger": "UnicodeDecodeError|codec can't decode|encoding error",
      "severity": "MEDIUM",
      "prevention": "Always specify encoding='utf-8' when reading/writing files",
      "fix": "Use errors='replace' or try different encoding",
      "confidence": 0.95
    },
    {
      "id": "PAT-VAL-001",
      "category": "validation_errors",
      "name": "Safety Block",
      "trigger": "S\\(x\\).*BLOCK|Safety.*violation|safety score.*below",
      "severity": "CRITICAL",
      "prevention": "Run prism_quality_safety before generating safety-critical output",
      "fix": "Review calculations, verify physics formulas, add safety margins",
      "confidence": 0.95
    },
    {
      "id": "PAT-VAL-002",
      "category": "validation_errors",
      "name": "Quality Below Threshold",
      "trigger": "Î©\\(x\\).*<.*0\\.65|quality.*below|WARN.*quality",
      "severity": "HIGH",
      "prevention": "Use prism_quality_omega to check before completion",
      "fix": "Improve evidence level, add more detail, verify completeness",
      "confidence": 0.85
    },
    {
      "id": "PAT-VAL-003",
      "category": "validation_errors",
      "name": "Anti-Regression Violation",
      "trigger": "regression|smaller.*than.*original|lost.*content|count.*decreased",
      "severity": "CRITICAL",
      "prevention": "Always count items before replacement, use prism_validate_anti_regression",
      "fix": "Restore from backup, compare old vs new, merge rather than replace",
      "confidence": 0.95
    },
    {
      "id": "PAT-PY-001",
      "category": "python_errors",
      "name": "KeyError",
      "trigger": "KeyError|key.*not found|missing key",
      "severity": "MEDIUM",
      "prevention": "Use .get() with default value, check key existence first",
      "fix": "Add missing key or use dict.get(key, default)",
      "confidence": 0.9
    },
    {
      "id": "PAT-PY-002",
      "category": "python_errors",
      "name": "TypeError",
      "trigger": "TypeError|unsupported operand|not.*callable|NoneType",
      "severity": "MEDIUM",
      "prevention": "Validate types before operations, check for None",
      "fix": "Add type checks, handle None case explicitly",
      "confidence": 0.85
    },
    {
      "id": "PAT-PY-003",
      "category": "python_errors",
      "name": "ImportError",
      "trigger": "ImportError|ModuleNotFoundError|No module named",
      "severity": "HIGH",
      "prevention": "Use try/except ImportError, add sys.path.insert for local modules",
      "fix": "Install missing package or fix import path",
      "confidence": 0.9
    },
    {
      "id": "PAT-CNC-001",
      "category": "cnc_errors",
      "name": "Spindle Overload",
      "trigger": "ALARM.*1[0-2]\\d\\d|spindle.*overload|spindle.*error",
      "severity": "CRITICAL",
      "prevention": "Calculate spindle load using Kienzle, reduce feed rate or depth",
      "fix": "Reduce cutting parameters, check tool condition, verify material properties",
      "confidence": 0.9
    },
    {
      "id": "PAT-CNC-002",
      "category": "cnc_errors",
      "name": "Axis Limit",
      "trigger": "ALARM.*50[0-9]|axis.*limit|travel.*exceeded|soft limit",
      "severity": "HIGH",
      "prevention": "Verify toolpath within machine envelope using prism_machine_get",
      "fix": "Adjust work offset, modify toolpath, check fixture position",
      "confidence": 0.85
    },
    {
      "id": "PAT-CNC-003",
      "category": "cnc_errors",
      "name": "Tool Breakage",
      "trigger": "tool.*break|tool.*broken|tool monitor|excessive.*load",
      "severity": "CRITICAL",
      "prevention": "Use Taylor tool life equation, monitor load percentage",
      "fix": "Replace tool, reduce parameters, verify material is correct",
      "confidence": 0.9
    },
    {
      "id": "PAT-DATA-001",
      "category": "data_errors",
      "name": "JSON Parse Error",
      "trigger": "JSONDecodeError|Invalid JSON|Expecting value|Unterminated string",
      "severity": "MEDIUM",
      "prevention": "Validate JSON before parsing, use prism_json_sort for consistency",
      "fix": "Check for trailing commas, missing quotes, malformed structure",
      "confidence": 0.9
    },
    {
      "id": "PAT-DATA-002",
      "category": "data_errors",
      "name": "Missing Required Field",
      "trigger": "required.*field|missing.*field|null.*not allowed|undefined",
      "severity": "MEDIUM",
      "prevention": "Validate data against schema before use",
      "fix": "Add missing field with appropriate default or mark as N/A",
      "confidence": 0.85
    },
    {
      "id": "PAT-DATA-003",
      "category": "data_errors",
      "name": "Out of Range",
      "trigger": "out of range|exceeds.*limit|invalid.*value|must be.*between",
      "severity": "HIGH",
      "prevention": "Validate numeric values against physical limits",
      "fix": "Clamp to valid range or reject with clear error",
      "confidence": 0.9
    },
    {
      "id": "PAT-SES-001",
      "category": "session_errors",
      "name": "Context Overflow",
      "trigger": "context.*full|token.*limit|maximum.*exceeded|CRITICAL.*context",
      "severity": "CRITICAL",
      "prevention": "Use prism_context_size regularly, compress at ORANGE",
      "fix": "Run prism_context_compress immediately, prepare handoff",
      "confidence": 0.95
    },
    {
      "id": "PAT-SES-002",
      "category": "session_errors",
      "name": "State Loss",
      "trigger": "state.*lost|progress.*lost|work.*lost|session.*terminated",
      "severity": "CRITICAL",
      "prevention": "Checkpoint every 5-8 items, use prism_checkpoint_create",
      "fix": "Recover from transcript, use prism_state_reconstruct",
      "confidence": 0.9
    },
    {
      "id": "PAT-SES-003",
      "category": "session_errors",
      "name": "Compaction Detected",
      "trigger": "compacted|context.*summary|Previous context|conversation.*compacted",
      "severity": "HIGH",
      "prevention": "Monitor context size, handoff before critical",
      "fix": "Use prism_compaction_detect, read transcript, resume with prism_session_resume",
      "confidence": 0.95
    }
  ],
  "learning_rules": {
    "min_occurrences_for_pattern": 2,
    "confidence_increase_on_success": 0.05,
    "confidence_decrease_on_failure": 0.1,
    "validation_threshold": 0.8,
    "auto_apply_threshold": 0.9
  },
  "integration": {
    "check_before_tool_call": true,
    "inject_into_prompts": true,
    "auto_learn_from_errors": true,
    "mcp_tools": [
      "prism_error_log",
      "prism_error_analyze",
      "prism_error_learn"
    ]
  }
}
