{"path":"src/tools/autoHookWrapper.ts","total_lines":1340,"showing":"1-101","content":" * autoHookWrapper.ts - Universal hook/cadence system\n * RECOVERED from dist/index.js bundle on 2026-02-10T00:38:09.318Z\n */\nimport * as fs from \"fs\";\nimport * as path from \"path\";\nimport { execSync } from \"child_process\";\nimport {\n  HookResult, ToolCallContext, ProofValidation, FactVerify,\n  HookExecution, RecordedAction, CompactionSurvivalData\n} from \"../types/prism-schema.js\";\nimport { HookExecutor } from \"../engines/HookExecutor.js\";\nimport {\n  autoTodoRefresh, autoCheckpoint, autoContextPressure,\n  autoContextCompress, autoCompactionDetect, autoCompactionSurvival,\n  rehydrateFromSurvival, autoAttentionScore, autoContextPullBack,\n  getCurrentPressurePct\n} from \"./cadenceExecutor.js\";\nimport { slimJsonResponse, slimCadence, getSlimLevel } from \"../utils/responseSlimmer.js\";\nimport { autoSkillHint, autoKnowledgeCrossQuery } from \"./cadenceExecutor.js\";\nimport { TelemetryEngine } from \"../engines/TelemetryEngine.js\";\nimport { MemoryGraphEngine } from \"../engines/MemoryGraphEngine.js\";\nimport { PredictiveFailureEngine } from \"../engines/PredictiveFailureEngine.js\";\n\nconst hookExecutor = new HookExecutor();\nlet telemetryEngine: TelemetryEngine | null = null;\nlet memoryGraphEngine: MemoryGraphEngine | null = null;\nlet pfpEngine: PredictiveFailureEngine | null = null;\n\nfunction getTelemetry(): TelemetryEngine {\n  if (!telemetryEngine) telemetryEngine = TelemetryEngine.getInstance();\n  return telemetryEngine;\n}\nfunction getMemoryGraph(): MemoryGraphEngine {\n  if (!memoryGraphEngine) memoryGraphEngine = MemoryGraphEngine.getInstance();\n  return memoryGraphEngine;\n}\nfunction getPFP(): PredictiveFailureEngine {\n  if (!pfpEngine) pfpEngine = PredictiveFailureEngine.getInstance();\n  return pfpEngine;\n}\n\nexport var AUTO_HOOK_CONFIG = {\n  enabled: true,\n  // Tools that trigger safety calculation hooks\n  calcTools: [\n    \"calc_cutting_force\",\n    \"calc_tool_life\",\n    \"calc_mrr\",\n    \"calc_surface_finish\",\n    \"calc_power\",\n    \"calc_deflection\",\n    \"calc_stability\",\n    \"calc_thermal\",\n    \"calc_speed_feed\",\n    \"calc_chip_load\",\n    \"calc_engagement\",\n    \"calc_trochoidal\",\n    \"calc_hsm\",\n    \"calc_scallop\",\n    \"calc_stepover\",\n    \"calc_cycle_time\",\n    \"calc_arc_fit\",\n    \"calc_cost_optimize\",\n    \"calc_multi_optimize\",\n    \"calc_productivity\",\n    \"prism_cutting_force\",\n    \"prism_tool_life\",\n    \"prism_speed_feed\",\n    \"prism_formula_calc\"\n  ],\n  // Tools that trigger factual verification\n  webTools: [\"web_search\", \"web_fetch\"],\n  // Claim indicators for Î¦(x) verification\n  claimIndicators: [\n    \"studies show\",\n    \"research indicates\",\n    \"according to\",\n    \"data shows\",\n    \"evidence suggests\",\n    \"proven that\",\n    \"the fact that\",\n    \"it is known that\",\n    \"established that\",\n    \"scientists found\",\n    \"experts agree\"\n  ],\n  // Safety thresholds\n  thresholds: {\n    lambda_min: 0.9,\n    phi_high: 0.85,\n    phi_moderate: 0.6,\n    safety_min: 0.7\n  }\n};\nvar hookHistory = [];\nvar MAX_HISTORY = 1e3;\nfunction logHookExecution(execution) {\n  hookHistory.unshift(execution);\n  if (hookHistory.length > MAX_HISTORY) {\n    hookHistory.pop();"}