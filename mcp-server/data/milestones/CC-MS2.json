{
  "id": "CC-MS2",
  "version": "3.1.0",
  "title": "Knowledge Extraction Engine (All Three Domains)",
  "brief": "Universal schema v2, CAD/CAM/SHOP extraction prompts, knowledge_extract.py, per-domain validators.",
  "created_at": "2026-02-26T20:14:19Z",
  "created_by": "claude-opus-4.6",
  "phases": [
    {
      "id": "P0",
      "title": "Knowledge Extraction Engine (All Three Domains)",
      "description": "Design universal knowledge schema v2, build domain-specific extraction prompts for CAD/CAM/SHOP, extraction orchestrator, per-domain validators. Test on 8 ingested videos.",
      "sessions": "3",
      "primary_role": "R3",
      "primary_model": "opus-4.6",
      "implementation_model": "sonnet-4.6",
      "execution_split": "CC 50% / MCP 50%",
      "units": [
        {
          "id": "P0-U01",
          "title": "Knowledge Extraction Engine (All Three Domains)",
          "phase": "P0",
          "sequence": 0,
          "role": "R3",
          "role_name": "Knowledge Engineer",
          "model": "opus-4.6",
          "implementation_model": "sonnet-4.6",
          "effort": 240,
          "tools": [
            { "tool": "prism_dev" },
            { "tool": "prism_validate" },
            { "tool": "prism_intelligence", "action": "knowledge queries" },
            { "tool": "prism_sp", "action": "brainstorm", "purpose": "schema design" }
          ],
          "skills": [],
          "scripts": [],
          "hooks": [],
          "features": [],
          "dependencies": ["CC-MS1"],
          "entry_conditions": [
            "CC-MS1 complete",
            "Anthropic API key configured",
            "8+ ingested videos available from CC-MS1"
          ],
          "exit_conditions": [
            "Universal knowledge schema v2 covers all 3 domains (CAD, CAM, SHOP)",
            "Extraction accuracy >80% compared to manual review",
            "Vision data integrated into extraction pipeline",
            "Cross-domain linking works (e.g., CAD feature -> CAM strategy -> SHOP practice)",
            "Build passes",
            "Tests pass"
          ],
          "rollback": "git checkout -- cad-engine/src/knowledge_extract.py cad-engine/src/prompts/ cad-engine/src/validators/ cad-engine/schemas/",
          "steps": [
            {
              "number": 1,
              "instruction": "Design universal knowledge schema v2 covering all 3 domains (Opus): CAD features/operations/parameters, CAM strategies/tools/params, SHOP practices/tips/troubleshooting with cross-domain links"
            },
            {
              "number": 2,
              "instruction": "Build CAD extraction prompts for P0 platforms (SolidWorks, Fusion 360, AutoCAD): feature tree extraction, dimension capture, constraint identification, design intent"
            },
            {
              "number": 3,
              "instruction": "Build CAM extraction prompts for P0 platforms (Mastercam, Fusion CAM, SolidWorks CAM): strategy identification, tool selection rationale, parameter extraction, toolpath sequencing"
            },
            {
              "number": 4,
              "instruction": "Build SHOP extraction prompts: setup procedures, cutting practices, tool management, troubleshooting procedures, material-specific tips, machine-specific tips"
            },
            {
              "number": 5,
              "instruction": "Build extraction orchestrator (knowledge_extract.py): domain classification -> select prompts -> merge transcript + OCR + vision data -> API call -> validate -> store with provenance"
            },
            {
              "number": 6,
              "instruction": "Build extraction validators per domain: CAD (feature tree logic consistency, dimension sanity), CAM (parameter range sanity vs material/tool), SHOP (practice consistency, no contradictions)"
            },
            {
              "number": 7,
              "instruction": "Test on 8 ingested videos: run full extraction pipeline, compare to manual review, measure accuracy per domain, verify cross-domain linking"
            }
          ],
          "deliverables": [
            "cad-engine/schemas/knowledge_schema_v2.json",
            "cad-engine/src/prompts/cad_prompts.py",
            "cad-engine/src/prompts/cam_prompts.py",
            "cad-engine/src/prompts/shop_prompts.py",
            "cad-engine/src/knowledge_extract.py",
            "cad-engine/src/validators/cad_validator.py",
            "cad-engine/src/validators/cam_validator.py",
            "cad-engine/src/validators/shop_validator.py",
            "cad-engine/tests/test_extraction.py"
          ],
          "index_in_master": false,
          "creates_skill": false,
          "creates_script": false,
          "creates_hook": false,
          "creates_command": false
        }
      ],
      "gate": {
        "omega_floor": 0.75,
        "safety_floor": 0.70,
        "ralph_required": false,
        "ralph_grade_floor": "B",
        "anti_regression": true,
        "test_required": true,
        "build_required": true,
        "checkpoint": true,
        "learning_save": true,
        "custom_checks": [
          "Schema v2 covers CAD + CAM + SHOP domains",
          "Extraction accuracy >80% vs manual review",
          "Cross-domain linking functional"
        ]
      },
      "scrutiny_checkpoint": false,
      "scrutiny_focus": []
    }
  ],
  "total_units": 1,
  "total_sessions": "3",
  "role_matrix": [
    {
      "code": "R3",
      "name": "Knowledge Engineer",
      "model": "opus-4.6",
      "implementation_model": "sonnet-4.6",
      "effort": 240
    }
  ],
  "tool_map": [
    { "tool": "prism_dev", "phases": ["P0"] },
    { "tool": "prism_validate", "phases": ["P0"] },
    { "tool": "prism_intelligence", "phases": ["P0"] },
    { "tool": "prism_sp", "phases": ["P0"] }
  ],
  "deliverables_index": [
    "cad-engine/schemas/knowledge_schema_v2.json",
    "cad-engine/src/knowledge_extract.py",
    "cad-engine/src/prompts/",
    "cad-engine/src/validators/"
  ],
  "existing_leverage": [],
  "scrutiny_config": {
    "pass_mode": "adaptive",
    "min_passes": 3,
    "max_passes": 7,
    "convergence_rule": "delta < 2",
    "escalation_rule": "if pass 4+ finds CRITICAL, flag for human review",
    "scrutinizer_model": "opus-4.6",
    "scrutinizer_effort": 90,
    "gap_categories": [
      "missing_tools",
      "missing_deps",
      "missing_exit_conditions",
      "missing_rollback",
      "sequence_errors"
    ],
    "improvement_threshold": 0.92
  }
}
