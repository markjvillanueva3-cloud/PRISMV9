{
  "id": "QA-MS1",
  "version": "1.0.0",
  "title": "Safety Chain Deep Audit",
  "brief": "Deep audit of the entire safety chain: SafetyEngine S(x) scoring, CoolantValidationEngine brackets, safety dispatcher actions, Lambda/Phi validation, safety factor application order, emergency stop paths, and integration test design.",
  "created_at": "2026-02-27T12:00:00Z",
  "created_by": "claude-opus-4.6",
  "phases": [
    {
      "id": "P0",
      "title": "Safety Chain Deep Audit",
      "description": "Verify every component in the safety chain: scoring formulas, validation brackets, dispatcher coverage, proxy validation, factor ordering, emergency paths, and design integration tests.",
      "sessions": "2-3",
      "primary_role": "R4",
      "primary_model": "opus-4.6",
      "units": [
        {
          "id": "P0-U00",
          "title": "SafetyEngine: S(x) scoring formula verification, hard block <0.70",
          "phase": "P0",
          "sequence": 0,
          "role": "R4",
          "role_name": "Auditor",
          "model": "opus-4.6",
          "effort": 90,
          "rationale": "OPUS/HIGH — critical safety formula must be mathematically verified",
          "tools": [{ "tool": "prism_calc" }, { "tool": "prism_validate" }],
          "skills": ["smart"],
          "scripts": [],
          "hooks": [],
          "features": [],
          "dependencies": [],
          "entry_conditions": ["QA-MS0 baseline complete", "Audit rubric available"],
          "exit_conditions": ["S(x) formula verified against specification", "Hard block threshold at <0.70 confirmed", "Edge cases at boundaries (0.69, 0.70, 0.71) documented"],
          "rollback": "git checkout -- state/QA-MS1/",
          "steps": [
            { "number": 1, "instruction": "Read SafetyEngine source and extract S(x) scoring formula" },
            { "number": 2, "instruction": "Verify formula components match safety specification" },
            { "number": 3, "instruction": "Test boundary conditions: S(x)=0.69 (block), S(x)=0.70 (pass), S(x)=0.71 (pass)" },
            { "number": 4, "instruction": "Document findings in state/QA-MS1/safety-engine-audit.json" }
          ],
          "deliverables": [{ "path": "state/QA-MS1/safety-engine-audit.json", "type": "data", "description": "SafetyEngine S(x) formula verification results" }],
          "index_in_master": false, "creates_skill": false, "creates_script": false, "creates_hook": false, "creates_command": false
        },
        {
          "id": "P0-U01",
          "title": "CoolantValidationEngine: all brackets, edge cases, speed bracket fix verify",
          "phase": "P0",
          "sequence": 1,
          "role": "R4",
          "role_name": "Auditor",
          "model": "opus-4.6",
          "effort": 90,
          "rationale": "OPUS/HIGH — known prior bug in speed bracket >300 branch, must verify fix and all brackets",
          "tools": [{ "tool": "prism_calc" }, { "tool": "prism_validate" }],
          "skills": ["smart"],
          "scripts": [],
          "hooks": [],
          "features": [],
          "dependencies": ["P0-U00"],
          "entry_conditions": ["SafetyEngine audit complete"],
          "exit_conditions": ["All coolant validation brackets verified", "Speed bracket fix at line 282 confirmed working", "Edge cases for all bracket boundaries documented"],
          "rollback": "git checkout -- state/QA-MS1/",
          "steps": [
            { "number": 1, "instruction": "Read CoolantValidationEngine and map all validation brackets" },
            { "number": 2, "instruction": "Verify the speed bracket fix (dead else if >300 branch, line 282)" },
            { "number": 3, "instruction": "Test all bracket boundary conditions" },
            { "number": 4, "instruction": "Document in state/QA-MS1/coolant-validation-audit.json" }
          ],
          "deliverables": [{ "path": "state/QA-MS1/coolant-validation-audit.json", "type": "data", "description": "CoolantValidationEngine bracket verification" }],
          "index_in_master": false, "creates_skill": false, "creates_script": false, "creates_hook": false, "creates_command": false
        },
        {
          "id": "P0-U02",
          "title": "Safety dispatcher actions: completeness vs engine coverage",
          "phase": "P0",
          "sequence": 2,
          "role": "R4",
          "role_name": "Auditor",
          "model": "sonnet-4.6",
          "effort": 70,
          "rationale": "SONNET/MEDIUM — systematic comparison of dispatcher actions vs engine methods",
          "tools": [{ "tool": "prism_validate" }, { "tool": "prism_intelligence", "action": "query" }],
          "skills": ["smart"],
          "scripts": [],
          "hooks": [],
          "features": [],
          "dependencies": ["P0-U01"],
          "entry_conditions": ["Safety engine audits complete"],
          "exit_conditions": ["All safety dispatcher actions mapped to engine methods", "Unwired actions identified", "Coverage percentage calculated"],
          "rollback": "git checkout -- state/QA-MS1/",
          "steps": [
            { "number": 1, "instruction": "Enumerate all safety-related dispatcher actions" },
            { "number": 2, "instruction": "Map each action to its engine method implementation" },
            { "number": 3, "instruction": "Calculate coverage percentage and identify gaps" },
            { "number": 4, "instruction": "Document in state/QA-MS1/safety-dispatcher-coverage.json" }
          ],
          "deliverables": [{ "path": "state/QA-MS1/safety-dispatcher-coverage.json", "type": "data", "description": "Safety dispatcher action coverage analysis" }],
          "index_in_master": false, "creates_skill": false, "creates_script": false, "creates_hook": false, "creates_command": false
        },
        {
          "id": "P0-U03",
          "title": "Lambda/Phi validation in auto-hook proxy",
          "phase": "P0",
          "sequence": 3,
          "role": "R4",
          "role_name": "Auditor",
          "model": "opus-4.6",
          "effort": 90,
          "rationale": "OPUS/HIGH — auto-hook proxy is a critical safety gateway",
          "tools": [{ "tool": "prism_validate" }],
          "skills": ["smart"],
          "scripts": [],
          "hooks": [],
          "features": [],
          "dependencies": ["P0-U02"],
          "entry_conditions": ["Safety dispatcher coverage analyzed"],
          "exit_conditions": ["Lambda validation logic verified", "Phi validation logic verified", "Proxy wrapping confirmed for all safety-critical paths"],
          "rollback": "git checkout -- state/QA-MS1/",
          "steps": [
            { "number": 1, "instruction": "Read auto-hook proxy implementation for Lambda/Phi validation" },
            { "number": 2, "instruction": "Verify Lambda bounds and rejection logic" },
            { "number": 3, "instruction": "Verify Phi bounds and rejection logic" },
            { "number": 4, "instruction": "Confirm proxy wraps all safety-critical dispatch paths" },
            { "number": 5, "instruction": "Document in state/QA-MS1/lambda-phi-audit.json" }
          ],
          "deliverables": [{ "path": "state/QA-MS1/lambda-phi-audit.json", "type": "data", "description": "Lambda/Phi validation audit results" }],
          "index_in_master": false, "creates_skill": false, "creates_script": false, "creates_hook": false, "creates_command": false
        },
        {
          "id": "P0-U04",
          "title": "Safety factor application order (after uncertainty, never before)",
          "phase": "P0",
          "sequence": 4,
          "role": "R4",
          "role_name": "Auditor",
          "model": "opus-4.6",
          "effort": 90,
          "rationale": "OPUS/HIGH — incorrect ordering could produce unsafe recommendations",
          "tools": [{ "tool": "prism_calc" }, { "tool": "prism_validate" }],
          "skills": ["smart"],
          "scripts": [],
          "hooks": [],
          "features": [],
          "dependencies": ["P0-U03"],
          "entry_conditions": ["Lambda/Phi audit complete"],
          "exit_conditions": ["Safety factor application order verified in all calculation paths", "No instances of safety factor applied before uncertainty propagation", "Order documented for each engine that uses safety factors"],
          "rollback": "git checkout -- state/QA-MS1/",
          "steps": [
            { "number": 1, "instruction": "Search all engines for safety factor application patterns" },
            { "number": 2, "instruction": "For each instance, verify it occurs AFTER uncertainty propagation" },
            { "number": 3, "instruction": "Flag any violations where safety factor is applied before uncertainty" },
            { "number": 4, "instruction": "Document in state/QA-MS1/safety-factor-order-audit.json" }
          ],
          "deliverables": [{ "path": "state/QA-MS1/safety-factor-order-audit.json", "type": "data", "description": "Safety factor application order verification" }],
          "index_in_master": false, "creates_skill": false, "creates_script": false, "creates_hook": false, "creates_command": false
        },
        {
          "id": "P0-U05",
          "title": "Emergency stop / hard block paths end-to-end trace",
          "phase": "P0",
          "sequence": 5,
          "role": "R4",
          "role_name": "Auditor",
          "model": "opus-4.6",
          "effort": 90,
          "rationale": "OPUS/HIGH — emergency paths must be verified end-to-end",
          "tools": [{ "tool": "prism_validate" }, { "tool": "prism_intelligence", "action": "query" }],
          "skills": ["smart"],
          "scripts": [],
          "hooks": [],
          "features": [],
          "dependencies": ["P0-U04"],
          "entry_conditions": ["Safety factor order audit complete"],
          "exit_conditions": ["All emergency stop trigger conditions documented", "Full execution path traced from trigger to halt", "Hard block paths verified to prevent unsafe output"],
          "rollback": "git checkout -- state/QA-MS1/",
          "steps": [
            { "number": 1, "instruction": "Identify all emergency stop / hard block trigger conditions in code" },
            { "number": 2, "instruction": "Trace each trigger through the execution chain to its halt point" },
            { "number": 3, "instruction": "Verify no bypass paths exist around hard blocks" },
            { "number": 4, "instruction": "Document in state/QA-MS1/emergency-paths-audit.json" }
          ],
          "deliverables": [{ "path": "state/QA-MS1/emergency-paths-audit.json", "type": "data", "description": "Emergency stop / hard block path trace results" }],
          "index_in_master": false, "creates_skill": false, "creates_script": false, "creates_hook": false, "creates_command": false
        },
        {
          "id": "P0-U06",
          "title": "Safety chain integration test design",
          "phase": "P0",
          "sequence": 6,
          "role": "R4",
          "role_name": "Auditor",
          "model": "sonnet-4.6",
          "effort": 70,
          "rationale": "SONNET/MEDIUM — test design based on prior audit findings",
          "tools": [{ "tool": "prism_validate" }],
          "skills": ["smart"],
          "scripts": [],
          "hooks": [],
          "features": [],
          "dependencies": ["P0-U05"],
          "entry_conditions": ["All safety chain audits complete"],
          "exit_conditions": ["Integration test suite designed covering all safety chain components", "Test cases include boundary conditions and failure modes", "Test priority ranked by safety criticality"],
          "rollback": "git checkout -- state/QA-MS1/",
          "steps": [
            { "number": 1, "instruction": "Design integration tests for SafetyEngine S(x) boundary conditions" },
            { "number": 2, "instruction": "Design tests for CoolantValidation bracket transitions" },
            { "number": 3, "instruction": "Design tests for emergency stop trigger-to-halt paths" },
            { "number": 4, "instruction": "Design tests for safety factor ordering" },
            { "number": 5, "instruction": "Save test design to state/QA-MS1/safety-integration-tests.json" }
          ],
          "deliverables": [{ "path": "state/QA-MS1/safety-integration-tests.json", "type": "test", "description": "Safety chain integration test suite design" }],
          "index_in_master": false, "creates_skill": false, "creates_script": false, "creates_hook": false, "creates_command": false
        }
      ],
      "gate": {
        "omega_floor": 0.80,
        "safety_floor": 0.85,
        "ralph_required": true,
        "ralph_grade_floor": "A",
        "anti_regression": true,
        "test_required": true,
        "build_required": true,
        "checkpoint": true,
        "learning_save": true,
        "custom_checks": ["All safety formulas verified", "No bypass paths found", "Safety factor ordering correct in all engines"]
      },
      "scrutiny_checkpoint": true,
      "scrutiny_focus": ["missing_tests", "missing_exit_conditions", "underspecified_steps"]
    }
  ],
  "total_units": 7,
  "total_sessions": "2-3",
  "role_matrix": [
    { "code": "R4", "name": "Auditor", "model": "opus-4.6", "effort": 90, "description": "Safety-critical verification auditor" },
    { "code": "R4", "name": "Auditor", "model": "sonnet-4.6", "effort": 70, "description": "Coverage analysis auditor" }
  ],
  "tool_map": [
    { "tool": "prism_calc", "phases": ["P0"], "purpose": "Verify calculation formulas" },
    { "tool": "prism_validate", "phases": ["P0"], "purpose": "Run validation checks" },
    { "tool": "prism_intelligence", "phases": ["P0"], "purpose": "Query system state" }
  ],
  "deliverables_index": [
    { "path": "state/QA-MS1/safety-engine-audit.json", "type": "data", "description": "SafetyEngine audit" },
    { "path": "state/QA-MS1/coolant-validation-audit.json", "type": "data", "description": "CoolantValidation audit" },
    { "path": "state/QA-MS1/safety-dispatcher-coverage.json", "type": "data", "description": "Safety dispatcher coverage" },
    { "path": "state/QA-MS1/lambda-phi-audit.json", "type": "data", "description": "Lambda/Phi audit" },
    { "path": "state/QA-MS1/safety-factor-order-audit.json", "type": "data", "description": "Safety factor order audit" },
    { "path": "state/QA-MS1/emergency-paths-audit.json", "type": "data", "description": "Emergency paths audit" },
    { "path": "state/QA-MS1/safety-integration-tests.json", "type": "test", "description": "Integration test design" }
  ],
  "existing_leverage": [
    { "asset": "SafetyEngine", "type": "source", "usage": "Primary audit target" },
    { "asset": "CoolantValidationEngine", "type": "source", "usage": "Speed bracket verification" },
    { "asset": "Auto-hook proxy", "type": "source", "usage": "Lambda/Phi validation target" }
  ],
  "scrutiny_config": {
    "pass_mode": "adaptive",
    "min_passes": 3,
    "max_passes": 7,
    "convergence_rule": "delta < 2",
    "escalation_rule": "if pass 4+ finds CRITICAL, flag for human review",
    "scrutinizer_model": "opus-4.6",
    "scrutinizer_effort": 90,
    "gap_categories": ["missing_tools", "missing_deps", "missing_exit_conditions", "missing_rollback", "sequence_errors", "missing_tests", "underspecified_steps"],
    "improvement_threshold": 0.92
  }
}
